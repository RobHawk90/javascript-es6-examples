{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["Negociacao","Mensagem","ListaNegociacoes","NegociacoesView","MensagemView","Bind","DateHelper","NegociacaoService","NegociacaoController","$","document","querySelector","bind","_$data","_$quantidade","_$valor","_listaNegociacoes","_mensagem","_service","_ordenacao","_init","listaCadastradas","then","adicionaTodas","negociacoes","catch","texto","error","event","preventDefault","negociacao","_criaNegociacao","cadastra","adiciona","mensagem","limpaCampos","apagaTodas","esvazia","value","focus","importa","coluna","inverteOrdem","ordena","a","b","dataStr","data","textoParaData","quantidade","valor"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {Negociacao} from '../models/Negociacao'\r\nimport {Mensagem} from '../models/Mensagem'\r\nimport {ListaNegociacoes} from '../models/ListaNegociacoes'\r\nimport {NegociacoesView} from '../views/NegociacoesView'\r\nimport {MensagemView} from '../views/MensagemView'\r\nimport {Bind} from '../helpers/Bind'\r\nimport {DateHelper} from '../helpers/DateHelper'\r\nimport {NegociacaoService} from '../services/NegociacaoService'\r\n\r\nexport class NegociacaoController {\r\n\r\n\tconstructor() {\r\n\t\tlet $ = document.querySelector.bind(document)\r\n\r\n\t\tthis._$data = $('#data')\r\n\t\tthis._$quantidade = $('#quantidade')\r\n\t\tthis._$valor = $('#valor')\r\n\r\n\t\t/* there's no need to save views as attributes since\r\n\t\twe are using one way data binding - model changes updates view */\r\n\t\tthis._listaNegociacoes = new Bind(\r\n\t\t\tnew ListaNegociacoes() // this model\r\n\t\t\t, new NegociacoesView($('#negociacoes_view')) // updates this view\r\n\t\t\t, 'adiciona', 'esvazia', 'ordena', 'inverteOrdem' // when this properties change\r\n\t\t)\r\n\r\n\t\tthis._mensagem = new Bind(\r\n\t\t\tnew Mensagem()\r\n\t\t\t, new MensagemView($('#mensagem_view'))\r\n\t\t\t, 'texto'\r\n\t\t)\r\n\r\n\t\tthis._service = new NegociacaoService()\r\n\t\tthis._ordenacao = '' // field of Negociacao order listaNegociacoes\r\n\r\n\t\tthis._init();\r\n\t}\r\n\r\n\t_init() {\r\n\t\tthis._service.listaCadastradas()\r\n\t\t\t.then(negociacoes => this._listaNegociacoes.adicionaTodas(negociacoes))\r\n\t\t\t.catch(error => this._mensagem.texto = error)\r\n\t}\r\n\r\n\tadiciona(event) {\r\n\t\tevent.preventDefault()\r\n\r\n\t\tlet negociacao = this._criaNegociacao()\r\n\r\n\t\tthis._service.cadastra(negociacao)\r\n\t\t\t.then(mensagem => {\r\n\t\t\t\tthis._listaNegociacoes.adiciona(negociacao)\r\n\t\t\t\tthis._mensagem.texto = mensagem\r\n\t\t\t\tthis.limpaCampos()\r\n\t\t\t})\r\n\t\t\t.catch(error => this._mensagem.texto = error)\r\n\t}\r\n\r\n\tapagaTudo() {\r\n\t\tthis._service.apagaTodas()\r\n\t\t\t.then(mensagem => {\r\n\t\t\t\tthis._listaNegociacoes.esvazia()\r\n\t\t\t\tthis._mensagem.texto = mensagem\r\n\t\t\t})\r\n\t\t\t.catch(error => this._mensagem.texto = error)\r\n\t}\r\n\r\n\t/* setting default values for each element */\r\n\tlimpaCampos() {\r\n\t\tthis._$data.value = \"\"\r\n\t\tthis._$quantidade.value = 1\r\n\t\tthis._$valor.value = 0\r\n\t\tthis._$data.focus()\r\n\t}\r\n\r\n\timportaNegociacoes() {\r\n\t\tthis._service.importa(this._listaNegociacoes.negociacoes)\r\n\t\t\t.then(negociacoes => {\r\n\t\t\t\tthis._listaNegociacoes.adicionaTodas(negociacoes)\r\n\t\t\t\tthis._mensagem.texto = 'As negociações da semana foram importadas.';\r\n\t\t\t})\r\n\t\t\t.catch(error => this._mensagem.texto = error)\r\n\t}\r\n\r\n\tordena(coluna) {\r\n\t\tif(this._ordenacao === coluna)\r\n\t\t\tthis._listaNegociacoes.inverteOrdem()\r\n\t\telse {\r\n\t\t\tthis._ordenacao = coluna\r\n\t\t\tthis._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\r\n\t\t}\r\n\t}\r\n\r\n\t/* retrieving form data */\r\n\t_criaNegociacao() {\r\n\t\tlet dataStr = this._$data.value;\r\n\t\tlet data = DateHelper.textoParaData(dataStr)\r\n\t\tlet quantidade = this._$quantidade.value\r\n\t\tlet valor = this._$valor.value\r\n\t\treturn new Negociacao(data, quantidade, valor)\r\n\t}\r\n\r\n}\r\n"]}
{"version":3,"sources":["../../app-es6/daos/NegociacaoDAO.js"],"names":["Negociacao","NegociacaoDAO","connection","_connection","_store","negociacao","Promise","resolve","reject","addRequest","transaction","objectStore","add","onsuccess","onerror","console","log","e","target","error","negociacoes","cursor","openCursor","result","value","push","Date","_data","_quantidade","_valor","continue","clearRequest","clear"],"mappings":";;;;;;;;;;;;;;;AAAQA,a,qBAAAA,U;;;;;;;;;;;;;;;;;;;;;4BAGKC,a;AAEZ,2BAAYC,UAAZ,EAAwB;AAAA;;AACvB,UAAKC,WAAL,GAAmBD,UAAnB;AACA,UAAKE,MAAL,GAAc,aAAd;AACA;;;;8BAEQC,U,EAAY;AAAA;;AACpB,aAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvC,WAAIC,aAAa,MAAKN,WAAL,CACfO,WADe,CACH,CAAC,MAAKN,MAAN,CADG,EACY,WADZ,EACyB;AADzB,QAEfO,WAFe,CAEH,MAAKP,MAFF,EAEU;AAFV,QAGfQ,GAHe,CAGXP,UAHW,CAAjB,CADuC,CAIrB;;AAElBI,kBAAWI,SAAX,GAAuB;AAAA,eAAMN,SAAN;AAAA,QAAvB;AACAE,kBAAWK,OAAX,GAAqB,aAAK;AACzBC,gBAAQC,GAAR,CAAYC,EAAEC,MAAF,CAASC,KAArB;AACAX,eAAO,0CAAP;AACA,QAHD;AAIA,OAXM,CAAP;AAYA;;;kCAEY;AAAA;;AACZ,aAAO,IAAIF,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvC,WAAIY,cAAc,EAAlB;;AAEA,WAAIC,SAAS,OAAKlB,WAAL,CACXO,WADW,CACC,CAAC,OAAKN,MAAN,CADD,EACgB,UADhB,EAEXO,WAFW,CAEC,OAAKP,MAFN,EAGXkB,UAHW,EAAb,CAHuC,CAMxB;;AAEfD,cAAOR,SAAP,GAAmB,aAAK;AACvB,YAAIU,SAASN,EAAEC,MAAF,CAASK,MAAtB,CADuB,CACM;;AAE7B,YAAGA,MAAH,EAAW;AAAE;AACZ,aAAIC,QAAQD,OAAOC,KAAnB;AACAJ,qBAAYK,IAAZ,CAAiB,IAAIzB,UAAJ,CAAe,IAAI0B,IAAJ,CAASF,MAAMG,KAAf,CAAf,EAAsCH,MAAMI,WAA5C,EAAyDJ,MAAMK,MAA/D,CAAjB;AACAN,gBAAOO,QAAP,GAHU,CAGQ;AAClB,SAJD,MAIOvB,QAAQa,WAAR,EAPgB,CAOK;AAC5B,QARD;;AAUAC,cAAOP,OAAP,GAAiB,aAAK;AACrBC,gBAAQC,GAAR,CAAYC,EAAEC,MAAF,CAASC,KAArB;AACAX,eAAO,+CAAP;AACA,QAHD;AAIA,OAtBM,CAAP;AAuBA;;;mCAEa;AAAA;;AACb,aAAO,IAAIF,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvC,WAAIuB,eAAe,OAAK5B,WAAL,CACjBO,WADiB,CACL,CAAC,OAAKN,MAAN,CADK,EACU,WADV,EAEjBO,WAFiB,CAEL,OAAKP,MAFA,EAGjB4B,KAHiB,EAAnB,CADuC,CAI7B;;AAEVD,oBAAalB,SAAb,GAAyB;AAAA,eAAMN,SAAN;AAAA,QAAzB;AACAwB,oBAAajB,OAAb,GAAuB,aAAK;AAC3BC,gBAAQC,GAAR,CAAYC,EAAEC,MAAF,CAASC,KAArB;AACAX,eAAO,yCAAP;AACA,QAHD;AAIA,OAXM,CAAP;AAYA","file":"NegociacaoDAO.js","sourcesContent":["import {Negociacao} from '../models/Negociacao'\r\n\r\n/* abstracts all data manipulation from indexedDB store 'negociacoes' */\r\nexport class NegociacaoDAO {\r\n\r\n\tconstructor(connection) {\r\n\t\tthis._connection = connection\r\n\t\tthis._store = 'negociacoes'\r\n\t}\r\n\r\n\tadiciona(negociacao) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet addRequest = this._connection\r\n\t\t\t\t.transaction([this._store], 'readwrite') // init transaction\r\n\t\t\t\t.objectStore(this._store) // open store\r\n\t\t\t\t.add(negociacao) // try to add the object in store\r\n\r\n\t\t\taddRequest.onsuccess = () => resolve()\r\n\t\t\taddRequest.onerror = e => {\r\n\t\t\t\tconsole.log(e.target.error)\r\n\t\t\t\treject('Não foi possível adicionar a negociacao.')\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tlistaTodas() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet negociacoes = []\r\n\r\n\t\t\tlet cursor = this._connection\r\n\t\t\t\t.transaction([this._store], 'readonly')\r\n\t\t\t\t.objectStore(this._store)\r\n\t\t\t\t.openCursor() // returns an object for data reading iteration\r\n\r\n\t\t\tcursor.onsuccess = e => {\r\n\t\t\t\tlet result = e.target.result // try to get actual result\r\n\r\n\t\t\t\tif(result) { // if is not the end of the cursor or there is data\r\n\t\t\t\t\tlet value = result.value\r\n\t\t\t\t\tnegociacoes.push(new Negociacao(new Date(value._data), value._quantidade, value._valor))\r\n\t\t\t\t\tresult.continue() // move pointer to next possible result\r\n\t\t\t\t} else resolve(negociacoes) // cursor iteration ends\r\n\t\t\t}\r\n\r\n\t\t\tcursor.onerror = e => {\r\n\t\t\t\tconsole.log(e.target.error)\r\n\t\t\t\treject('Não foi possível obter as negociações salvas.')\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tremoveTodas() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet clearRequest = this._connection\r\n\t\t\t\t.transaction([this._store], 'readwrite')\r\n\t\t\t\t.objectStore(this._store)\r\n\t\t\t\t.clear() // remove all data in store\r\n\r\n\t\t\tclearRequest.onsuccess = () => resolve()\r\n\t\t\tclearRequest.onerror = e => {\r\n\t\t\t\tconsole.log(e.target.error)\r\n\t\t\t\treject('Não foi possível apagar as negociações.')\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n}\r\n"]}